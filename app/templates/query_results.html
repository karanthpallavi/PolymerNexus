<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SPARQL Query Results</title>
    <!-- Buttons for Download -->
    <br>
    <button onclick="downloadCSV()">Download as CSV</button>
    <button onclick="downloadExcel()">Download as Excel</button>

    <style>
        .ui-btn {
  background:#33bdb1;
  color:white;
  padding:10px 18px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-size:14px;
  font-weight:600;
  transition:background .3s, transform .1s;
}
.ui-btn:hover { background:#2ca398; }
.ui-btn:active { transform:scale(.97); }

        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }
    </style>

    <script>
        function extractTableData() {
            let table = document.querySelector("table");
            let rows = [];

            // Get headers
            let headers = [];
            table.querySelectorAll("th").forEach(th => headers.push(th.innerText));
            rows.push(headers);

            // Get table rows
            table.querySelectorAll("tr").forEach((tr, index) => {
                if (index === 0) return; // Skip header row
                let rowData = [];
                tr.querySelectorAll("td").forEach(td => rowData.push(td.innerText));
                rows.push(rowData);
            });

            return rows;
        }

        function downloadCSV() {
            let tableData = extractTableData();

            fetch("/generate_csv", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ data: tableData })
            })
            .then(response => response.blob())
            .then(blob => {
                let url = window.URL.createObjectURL(blob);
                let a = document.createElement("a");
                a.href = url;
                a.download = "query_results.csv";
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            })
            .catch(error => console.error("Error downloading CSV:", error));
        }

        function downloadExcel() {
            let tableData = extractTableData();

            fetch("/generate_excel", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ data: tableData })
            })
            .then(response => response.blob())
            .then(blob => {
                let url = window.URL.createObjectURL(blob);
                let a = document.createElement("a");
                a.href = url;
                a.download = "query_results.xlsx";
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            })
            .catch(error => console.error("Error downloading Excel:", error));
        }
    </script>

</head>
<body>

<h1>SPARQL Query Results</h1>

{% if template_name in ["multi_property_comparison", "filter_by_single_quality"] %}
<p style="font-weight: bold; color: green;">
    Number of rows: {{ results|length }}
</p>
{% endif %}
<div style="display:flex; justify-content:space-between; margin-bottom:15px;">
    <button class="ui-btn" onclick="window.location.href='/query'">‚Üê Back to Query</button>
</div>

{% if results and results|length > 0 %}
<table>
    <thead>
    <tr>
        {% for header in results[0].keys() %}
        <th>{{ header }}</th>
        {% endfor %}
    </tr>
    </thead>
    <tbody>
    {% for row in results %}
    <tr>
        {% for key, val in row.items() %}
        <td>{{ val.value }}</td>
        {% endfor %}
    </tr>
    {% endfor %}
    </tbody>
</table>
{% else %}
<p>No results found.</p>
{% endif %}

</body>
</html>